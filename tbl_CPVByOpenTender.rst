.. _tbl_CPVByOpenTender:

tbl_CPVByOpenTender
===================

Данная аналитическая таблица хранит все предметы закупок, которые были успешно приобретены с помощью конкурентных методов закупок.

Данная аналитическая таблица содержит следующую информацию:
 - Код предмета закупки.
 
Пример того, как может выглядеть таблица:

=====================
Код предмета закупки 
---------------------
Код предмета 1           
Код предмета 2       
Код предмета 3       
Код предмета 4       
Код предмета 5       
....                    
=====================

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица расчитывается 1 раз в сутки.

****************
Поля для расчета
****************

- ``data.tender.status``
- ``data.tender.procurementMethod``
- ``data.tender.items.classification.scheme``
- ``data.tender.items.classification.id``
- ``data.awards.relatedLot``

***********************
Формула расчета таблицы
***********************

1. Перед расчетом таблица очищается.
2. Выбираем только процедуры, ``data.tender.procurementMethod = 'open'``.
3. Выбираем только завершенные процедуры ``data.tender.status = 'contractSigned'``.
4. Из выбранных процедур выбираем все блоки определения победителя, где ``data.awards.status = 'active'``.
5. Из блоков определения победителя выбираем идентификаторы лотов, к которым относятся эти блоки ``data.awards.relatedLot``.
6. Находим все ``data.items``, которые относятся к этим лотам ``data.awards.relatedLot = data.items.relatedLot``.
7. Выбираем все коды закупок (конкатенация ``data.tender.items.classification.scheme`` и ``data.tender.items.classification.id``) из найденных ``data.items``.
8. Список из уникальных кодов закупок заносим в таблицу.