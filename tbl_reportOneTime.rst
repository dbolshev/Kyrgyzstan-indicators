.. _tbl_reportOneTime:

tbl_reportOneTime
=================

Данная аналитическая таблица хранит все предметы закупок для каждой закупающей организации, которые она закупала методом заключения прямого договора, используя причину заключения "приобретения товаров, работ и услуг по каждой статье расходов один раз в год до минимальной пороговой суммы".

Данная аналитическая таблица содержит следующую информацию:
 - Идентификатор закупающей организации;
 - Код предмета закупки по общему классификатору государственных закупок;
 - Дата первой закупки данного предмета закупки.

Пример того, как может выглядеть таблица:

======================== ===================== ======
Закупающая организация   Код предмета закупки  Дата
------------------------ --------------------- ------
Закупающая организация 1 Код предмета 1        Дата 1     
Закупающая организация 1 Код предмета 2        Дата 2
Закупающая организация 1 Код предмета 3        Дата 3
Закупающая организация 2 Код предмета 1        Дата 1
Закупающая организация 2 Код предмета 2        Дата 2
....                     ....
======================== ===================== ======

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица рассчитывается 1 раз в сутки.

****************
Поля для расчета
****************

- ``data.tender.procurementMethodRationale``
- ``data.tender.items.classification.scheme``
- ``data.tender.items.classification.id``
- ``parties.id``
- ``parties.roles``
- ``date``

***********************
Формула расчета таблицы
***********************
1. Выбираем только процедуры, ``data.tender.procurementMethodRationale = 'PROC_ONCE_IN_A_YEAR'``.
2. Перед расчетом таблица очищается.
3. Выбираем все процедуры прямого заключения договора по причине "приобретения товаров, работ и услуг по каждой статье расходов один раз в год до минимальной пороговой суммы" в хронологии их объявления.
4. Из каждой найденной процедуры извлекаем идентификатор закупающей организации ``parties.id``, такой что ``parties.roles = 'buyer, procuringEntity'``.
5. Извлекаем дату оглашения процедуры ``date``.
6. Извлекаем все предметы закупок (конкатенация ``data.tender.items.classification.scheme`` и ``data.tender.items.classification.id``).
7. Полученные данные заносим в таблицу, если по данной закупающей организации и данному предмету закупки еще нет записи в таблице.

