#####################################################################################################################################################################
KRAI1_1. Суммарная закупка методом прямого заключения договора на приобретения товаров, работ и услуг по каждой статье расходов в год до минимальной пороговой суммы.
#####################################################################################################################################################################

***************
Суть индикатора
***************

Индикатор отслеживает случаи, когда закупающая организация проводит ряд конкурсов методом прямого заключения договора с обоснованием "приобретения товаров, работ и услуг по каждой статье расходов  в год до минимальной пороговой суммы", но в текущем году общая сумма закупок по данному предмету закупки у закупающей организации превышает минимальную пороговую сумму.

****
Риск
****
Избегание применения конкурсных процедур с целью заключения договора с "удобным" поставщиком. 

*******************************
Нарушение норм/принципов закона
*******************************

Пункт 3 раздела 4 статьи 21: "3) приобретения товаров, работ и услуг по каждой статье расходов в течение года до минимальной пороговой суммы, независимо от заложенной суммы в статье расходов на финансовый год. При этом стоимость неделимого предмета закупок не должна превышать минимальную пороговую сумму".

***********************************
Основание для разработки индикатора
***********************************

Свидетельствует о нарушении статьи 21 Закона Кыргызской Республики "О государственных закупках".
Индикатор вводится, так как в системе не реализован контроль суммы закупок закупающей организации методом прямого заключения договора с одинаковым предметом закупки.

***********************
Дата запуска индикатора
***********************
Индикатор вводится в работу 29.06.2019 в связи со вступлением в действие измененного Закона КР о госзакупках.


*****************************
Прекращение работы индикатора
*****************************
Индикатор работает до 30-09-2019 в связи с введением валидaции в системе госзакупок.

*******************************
Методология расчета индикатора.
*******************************

Уровень расчета
===============
Индикатор расcчитывается на уровне *процедуры*.

Источники данных для расчета
============================

Для расчета индикатора используются следующие источники данных:

- API системы государственных закупок в OCDS формате
- Аналитическая таблица :ref:`tbl_reportOneTime_1`
- Транзакционные переменнные :ref:`tv_tenderCPVList`, :ref:`tv_badDataQuality`

Типы процедур
=============

Индикатор рассчитывается для следующих типов процедур:

- метод прямого заключения договора.


Статусы процедур
----------------

Индикатор расчитывается для процедур, которые:

- находятся в статусе ``complete``


Частота расчета
===============

Если выполнены все условия для активации расчета индикатор, он рассчитывается один раз.

Поля для расчета
================

Для расчета индикатора используются следующие поля API модуля системы гос. закупок:

- ``data.tender.procurementMethodRationale``
- ``data.tender.items.id``
- ``data.tender.items.classification.id``
- ``data.tender.items.relatedLot``
- ``data.tender.items.quantity``
- ``data.tender.items.relatedLot``
- ``data.awards.status``
- ``data.awards.relatedLot``
- ``data.awards.relatedBid``
- ``data.bid.details.priceProposal.relatedItem``
- ``data.bid.details.priceProposal.unit.value.amount``
- ``data.tender.lots.id``
- ``data.tender.lots.status``
- ``data.tender.items.classification.scheme``
- ``data.tender.items.classification.id``
- ``data.parties.id``
- ``data.parties.roles``
- ``data.tender.datePublished``
- ``data.tender.date``

Для расчета используются следующие транзакционные переменные:

- :ref:`tv_tenderCPVList`

Для расчета используются следующие аналитические таблицы:

- :ref:`tbl_reportOneTime_1`, :ref:`tv_badDataQuality`

Качество данных
===============

Если значение переменной :ref:`tv_badDataQuality` для данной процедуры равно ``true``, индикатор принимает значение ``-1`` и расчет его не производится.

Формула расчета
===============

1. Выбираем только процедуры, ``data.tender.procurementMethodRationale = 'annualProcurement'``.

2. Выбираем все значения классификаторов из перменной :ref:`tv_tenderCPVList`.

3. Выбираем идентификатор закупающей организации:  ``parties.id``, для которой ``parties.roles = 'buyer, procuringEntity'``.

4. По идентификатору закупающей организации в аналитической таблице находим список всех предметов закупок, которые уже закупались ранее (в поле ``data.tender.date`` текущей процедуры стоит более поздняя дата, чем дата в строке таблицы) в этом году прямым заключением договора по причине "Приобретения товаров, работ и услуг по каждой статье расходов один раз в год до минимальной пороговой суммы".

5. Для каждого найденного предмета закупки проводим следующие действия:

   - находим блок ``data.tender.items.id``, у которого код предмета закупки ``data.tender.items.classification.id`` аналогичный найденному в таблице
   
   - выбираем количество предмета закупки, которое нужно закупить ``data.tender.items.quantity``
   
   - находим идентификатор лота, к которому относится предмет закупки ``data.tender.items.relatedLot`` и который имеет ``data.lots.status = 'complete'`` или ``data.lots.status = 'complete'``.
   
   - по идентификатору д=лота находим награждение победителя для этого лота ``data.tender.items.relatedLot`` = ``data.awards.relatedLot``, который имеет статус ``data.awards.status = 'active'``
   
   - из награждения победителя узнаем идентификатор предложения победителя ``data.awards.relatedBid``
   
   - из предложения победителя выбираем предложение по нашему предмету закупки ``data.bid.details.priceProposal.relatedItem`` = ``data.tender.items.id``
   
   - находим цену победителя для нашего предмета закупки ``data.bid.details.priceProposal.unit.value.amount``
   
   - находим сумму предмета закупки, умножив количество ``data.tender.items.quantity`` на цену ``data.bid.details.priceProposal.unit.value.amount``
   
   - если найденная сумма предмета закупки вместе с суммой из аналитической таблицы превышает 1000000 сом, индикатор принимает значение ``1``, расчет заканчивается.
 
 6. Если мы дошли до этого пункта, индикатор принимает значение ``0``

Факторы, которые влияют на корректное срабатывание индикатора
=============================================================

Индикатор может срабатывать неправильно, если код предмета закупки, указанный закупающей организацией не детализирован достаточно для точной идентификации предмета закупки.
