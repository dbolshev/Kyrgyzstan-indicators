######################################################################################################################################################
KRAI29. Все участники лота были дисквалифицированы, кроме победителя (4+ участника).
######################################################################################################################################################

***************
Суть индикатора
***************

Индикатор отслеживает случаи, когда закупающая организация в лоте с большой конкуренцией дисквалифицирует всех поставщиков, кроме поставщика с самым экономически невыгодным предложением.

****
Риск
****

Риск сговора между представителями закупающей организации и участником конкурса. 


*******************************
Нарушение норм/принципов закона
*******************************

Статья 1, п.2 - создания равных и справедливых условий для поставщиков (подрядчиков) при осуществлении государственных закупок.


***********************************
Основание для разработки индикатора
***********************************

Индикатор вводится так как в системе не отслеживается количество дисквалификаций в лоте.

******************************
Методология расчета индикатора
******************************

Уровень расчета
===============
Индикатор рассчитывается на уровне *лота*.

Источники данных для расчета
============================

Для расчета индикатора используются следующие источники данных:

- API системы государственных закупок в OCDS формате
- транзакционная переменная :ref:`tv_badDataQuality`


Типы процедур
=============

Индикатор рассчитывается для следующих типов процедур:

- одноэтапные процедуры;
- двухэтапные процедуры;
- процедуры упрощенным методом;
- процедуры методом на понижение цены.


Статусы процедур
----------------

Индикатор рассчитывается для процедур, которые:

- находятся в статусе ``complete``
- находятся в статусе ``active`` c ``currentStage = 'evaluationComplete'`` более 30 дней (количество дней вычисляется, как количество дней от текущей даты до самой ранней даты из объектов ``data.awards``).

Частота расчета
===============

Если выполнены все условия для активации расчета индикатор, он рассчитывается один раз.

Поля для расчета
================

Для расчета индикатора используются следующие поля API модуля системы гос. закупок:

- ``data.tender.lots.id``
- ``data.bids.status``
- ``data.bids.relatedLots.id``
- ``data.awards.status``
- ``data.awards.relatedLot``
- ``data.lots.id``

Качество данных
===============

Если значение переменной :ref:`tv_badDataQuality` для данной процедуры равно ``true``, индикатор принимает значение ``-1`` и расчет его не производится.

Формула расчета
===============

1. Для каждого лота ``data.tender.lots.id`` процедуры выбираем количество поданных предложений: объектов ``data.bids``, которые имеют ``data.bids.status = 'valid'`` и у которых ``data.bids.relatedLots.id = data.tender.lots.id`` нашего лота.

2. Считаем количество таких предложений для каждого лота.

3. Если количество предложений меньше 4, индикатор принимает значение ``0`` для исследуемого лота и расчет заканчивается.

4. Для каждого лота процедуры выбираем все объекты определения победителя ``data.awards.relatedLot = data.lots.id``. Считаем их количество.

5. Если количество определений победителя меньше, чем количество предложений, индикатор принимает значение ``0`` для исследуемого лота и расчет заканчивается.

6. Выбираем статусы ``data.awards.status`` найденных определений победителя.

7. Смотрим на уникальные виды статусов. Если уникальные виды статусов составляют пару ``active`` и ``disqualified``, индикатор принимает значение ``1`` для исследуемого лота. В противном случае, индикатор принимает значение ``0`` для исследуемого лота.

8. Если хотя бы для одного лота индикатор равен ``1``, то индикатор равен ``1`` для всей процедуры. В противном случае, индикатор для процедуры равен ``0``.

Факторы, которые влияют на корректное срабатывание индикатора
=============================================================

Индикатор может срабатывать неправильно, если закупающая организация не отображает на портале все фактически пройденные этапы процедуры закупки.
