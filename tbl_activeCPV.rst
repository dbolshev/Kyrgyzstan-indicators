.. _tbl_activeCPV:

tbl_activeCPV
=============

Данная аналитическая таблица хранит все коды предметов закупок для каждой закупающей организации, в отношении которых процедуры закупки не были доведены до конца.

Данная аналитическая таблица содержит следующую информацию:
 - Идентификатор закупающей организации;
 - Код предмета закупки по общему классификатору государственных закупок;
 - Дата объявления процедуры закупки.

Пример того, как может выглядеть таблица:

======================== ===================== ======
Закупающая организация   Код предмета закупки  Дата
------------------------ --------------------- ------
Закупающая организация 1 Код предмета 1        Дата 1     
Закупающая организация 1 Код предмета 2        Дата 2
Закупающая организация 1 Код предмета 3        Дата 3
Закупающая организация 2 Код предмета 1        Дата 1
Закупающая организация 2 Код предмета 2        Дата 2
....                     ....
======================== ===================== ======

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.
- Транзакционная переменная :ref:`tv_tenderCPVList`

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица расчитывается 1 раз в сутки.

****************
Поля для расчета
****************

- ``data.date``
- ``data.tender.status``
- ``data.parties.roles``
- ``data.parties.identifier.scheme``
- ``data.parties.identifier.id``

***********************
Формула расчета таблицы
***********************
1. Перед расчетом таблица очищается.
2. Выбираем только процедуры проводимые одноэтапным методом, упрощенным методом или методом на понижение цены, дата оглашения которых ``data.date`` находится в промежутке от начала текущего календарного года до текущей даты.
3. Из найденных процедур берем только те, которые имеют ``data.tender.status = 'bidsOpened'`` или ``data.tender.status = 'evaluationResultsPending'``.
4. Определяем идентификатор закупающей организации (конкатенация ``data.parties.identifier.scheme`` и ``data.parties.identifier.id``) элемента ``data.parties``, у которого ``data.parties.roles = 'buyer, procuringEntity'``.
5. Из выбранных процедур берем их переменные :ref:`tv_tenderCPVList`. Разделяем переменную на отдельные коды предметов закупки.
6. Группируем получившиеся данные по идентификатору закупающей организации и коду предмета закупки, выбирая самую раннюю дату для каждого предмета закупки.
7. Полученные данные заносим в таблицу.