.. _tbl_additionalProcurements:

tbl_additionalProcurements
==========================

Данная аналитическая таблица хранит все конкурсы, на которые ссылались закупающие организации при дозакупке товаров/услуг/работ до 5%, используя метод прямого заключения договора.

Данная аналитическая таблица содержит следующую информацию:
 - Идентификатор закупающей организации.
 - Номер конкурса.
 
Пример того, как может выглядеть таблица:

====================== ================
Закупающая организация Номер конкурса
---------------------- ----------------
Идентификатор 1        Номер 1
Идентификатор 1        Номер 2
Идентификатор 2        Номер 3
Идентификатор 2        Номер 4
Идентификатор 3        Номер 5
...                    ...
====================== ================

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица рассчитывается 1 раз в сутки.

****************
Поля для расчета
****************



***********************
Формула расчета таблицы
***********************

1. Перед расчетом таблица для текущего календарного очищается. Таблицы, расчитанные для более ранних годов остаются неизменными.
2. Проводим расчеты отдельно для каждого календарного года, начиная с 2018-го.
3. Выбираем только одноэтапные, упрощенные и процедуры методом на понижение цены, у которых ``data.tender.datePublished`` находится в текущем году.
4. Выбираем только завершенные процедуры ``data.tender.status = 'complete'``.
5. Из выбранных процедур выбираем все блоки определения победителя, где ``data.awards.status = 'active'``.
6. Из блоков определения победителя выбираем идентификаторы лотов, к которым относятся эти блоки ``data.awards.relatedLot``.
7. Находим все ``data.items``, которые относятся к этим лотам ``data.awards.relatedLot = data.items.relatedLot``.
8. Выбираем все коды закупок (конкатенация ``data.tender.items.classification.scheme`` и ``data.tender.items.classification.id``) из найденных ``data.items``.
9. Список из уникальных кодов закупок и год расчета заносим в таблицу.
