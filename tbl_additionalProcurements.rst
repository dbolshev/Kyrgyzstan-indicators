.. _tbl_additionalProcurements:

tbl_additionalProcurements
==========================

Данная аналитическая таблица хранит все конкурсы, на которые ссылались закупающие организации при дозакупке товаров/услуг/работ до 5%, используя метод прямого заключения договора.

Данная аналитическая таблица содержит следующую информацию:
 - Идентификатор закупающей организации.
 - Номер конкурса.
 
Пример того, как может выглядеть таблица:

====================== ================
Закупающая организация Номер конкурса
---------------------- ----------------
Идентификатор 1        Номер 1
Идентификатор 1        Номер 2
Идентификатор 2        Номер 3
Идентификатор 2        Номер 4
Идентификатор 3        Номер 5
...                    ...
====================== ================

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица рассчитывается 1 раз в сутки.

****************
Поля для расчета
****************

- ``data.tender.procurementMethodRationale``
- ``data.tender.procurementMethodDetails``
- ``data.tender.tenderNumber``
- ``data.tender.datePublished``
- ``data.relatedProcesses.tenderNumber``
- ``data.parties.id``
- ``data.parties.roles``

***********************
Формула расчета таблицы
***********************

1. Выбираем только закупки, у которых ``data.tender.procurementMethodRationale='additionalProcurement5'`` и у которых год из даты ``data.tender.datePublished`` равен текущему.

2. Для каждой найденной закупки проводим следующие действия.

3. Выбираем номер конкурса, на который ссылается закупающая организация ``data.relatedProcesses.tenderNumber``.

4. Из найденного номера удаляем все символы, кроме цифр.

5. В системе госзакупок находим конкурс с таким номером ``data.tender.tenderNumber=data.relatedProcesses.tenderNumber``.

6. Если по номеру конкурс найти не удалось, работа с этой закупкой заканчивается.

7. Если конкурс найден, то смотрим его тип ``data.tender.procurementMethodDetails``. Если ``data.tender.procurementMethodDetails='singleSource'``, работа с этой закупкой заканчивается.

8. Выбиреам идентификатор закупающей организации - ``data.parties.id``, где ``data.parties.roles='buyer'``.

9. Идентификатор закупающей организации и номер найденного конкурса записываем как строку в таблицу.
